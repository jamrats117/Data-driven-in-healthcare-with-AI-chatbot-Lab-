ฉันต้องการสร้าง Google Apps Script สำหรับเชื่อมต่อกับ Dialogflow เพื่อรับข้อมูลจาก Google Sheet และส่งผลลัพธ์กลับไป โดยมีรายละเอียดดังนี้:
รายละเอียดโปรเจกต์:
ข้อมูลการเชื่อมต่อ: ฉันใช้ Google Apps Script เพื่อเก็บค่า SHEET_ID และ SHEET_NAME ไว้ใน Script Properties
ข้อมูลใน Google Sheet: Google Sheet ประกอบด้วย 6 คอลัมน์ดังนี้:
คอลัมน์ 1: code
คอลัมน์ 2: herb (ชื่อสมุนไพร)
คอลัมน์ 3: effect (ผลต่อ INR)
คอลัมน์ 4: description
คอลัมน์ 5: loe (ระดับคุณภาพหลักฐาน)
คอลัมน์ 6: ref (แหล่งอ้างอิง)
การทำงานของแชทบอท:
เมื่อผู้ใช้พิมพ์ชื่อสมุนไพรในแชทบอท เช่น "ขิง" ระบบจะไปค้นหาข้อมูลจาก Google Sheet โดยใช้ชื่อสมุนไพรที่ตรงกับคอลัมน์ herb แล้วแสดงข้อมูลจากคอลัมน์ herb และ effect กลับไปยังผู้ใช้
การเชื่อมต่อกับ Dialogflow:
ฉันต้องการให้โค้ดนี้รับข้อมูลจาก API response ของ Dialogflow โดยใช้พารามิเตอร์ herb_entity ซึ่งจะระบุชื่อสมุนไพรที่ผู้ใช้ค้นหา โดยข้อมูลพารามิเตอร์จะอยู่ใน outputContexts ตามโครงสร้าง API response ดังนี้:
{
  "responseId": "90db35a4-384c-4ba2-b290-06b3b155ac8d-0fffcc35",
  "queryResult": {
    "outputContexts": [
      {
        "parameters": {
          "herb_entity": "มะม่วง"
        }
      }
    ]
  }
}

ฟังก์ชันที่ต้องการ:
รับข้อมูลจาก Dialogflow: รับชื่อสมุนไพรจากพารามิเตอร์ herb_entity ใน outputContexts ของ API response
ค้นหาข้อมูลใน Google Sheets: ค้นหาข้อมูลจากคอลัมน์ herb และดึงข้อมูลจากคอลัมน์ effect หากพบสมุนไพรที่ตรงกัน
แสดงผลลัพธ์: ส่งผลลัพธ์กลับไปในรูปแบบ:
สมุนไพร: [ชื่อสมุนไพร]
ผลต่อ INR: [ข้อมูลจากคอลัมน์ 3]

การจัดการกรณีไม่พบสมุนไพร: หากไม่พบชื่อสมุนไพรใน Google Sheet ให้ส่งข้อความ:
ไม่พบสมุนไพรในระบบ กรุณาสอบถาม Admin

***ข้อมูลสำคัญสำหรับสร้าง code***
✅ ผมติตตั้ง better log ในไฟล comment.gs เพื่อทำการ debugging แบบนี้ var log = BetterLog.useSpreadsheet(); โปรดแทรกโคด better log เพื่อ track แต่ละขั้นตอนด้วยครับ
✅ ใน better log ใช้ได้แค่ log.info(...) เท่านั้น ห้ามใช้แบบอื่นนอกเหนือจาก info เช่น warning, error เป็นต้น
✅ log ทุกอันที่มีการแสดงค่าจากตัวแปรต้องใช้ JSON.stringify() เสมอ
